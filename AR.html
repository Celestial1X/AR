<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏´‡∏ô‡∏±‡∏á‡∏ï‡∏∞‡∏•‡∏∏‡∏á AR</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #111;
      display: flex;
      font-family: sans-serif;
    }
    /* ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ */
    #webcam-container {
      flex: 1;
      position: relative;
      background: black;
    }
    #webcam {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1); /* ‡∏û‡∏•‡∏¥‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏£‡∏∞‡∏à‡∏Å */
    }
    /* ‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤ ‡∏´‡∏ô‡∏±‡∏á‡∏ï‡∏∞‡∏•‡∏∏‡∏á */
    #puppet-container {
      flex: 1;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #222;
      overflow: hidden;
    }
    #puppet {
      display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
      width: 100%;
      height: 100%;
      object-fit: contain;
      max-height: 100%;
      mix-blend-mode: lighten; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    }
    #status {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 15px;
      border-radius: 10px;
      font-size: 14px;
    }
    /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö */
    #backBtn {
      position: fixed; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
      top: 10px;
      left: 10px;
      background: #fcd34d;
      color: black;
      padding: 10px 15px;
      border-radius: 8px;
      font-weight: bold;
      text-decoration: none;
      z-index: 1000;
      transition: background 0.3s;
    }
    #backBtn:hover {
      background: #fbbf24;
    }
  </style>
</head>
<body>
  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö -->
  <a href="index.html" id="backBtn">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>

  <!-- ‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
  <div id="webcam-container">
    <video id="webcam" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <div id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß...</div>
  </div>

  <!-- GIF ‡∏´‡∏ô‡∏±‡∏á‡∏ï‡∏∞‡∏•‡∏∏‡∏á -->
  <div id="puppet-container">
    <img id="puppet" src="https://archive.clib.psu.ac.th/online-exhibition/talung/image/peak.gif" alt="‡∏´‡∏ô‡∏±‡∏á‡∏ï‡∏∞‡∏•‡∏∏‡∏á‡πÇ‡∏ö‡∏Å‡∏°‡∏∑‡∏≠">
  </div>

  <script>
    (async function(){
      const video = document.getElementById('webcam');
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d', { willReadFrequently: true });
      const puppet = document.getElementById('puppet');
      const status = document.getElementById('status');

      let lastFrameData = null;
      let motionTimeout = null;

      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        video.addEventListener('loadedmetadata', () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          requestAnimationFrame(checkMotion);
        });
      } catch(e) {
        status.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: " + e;
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß
      function checkMotion(){
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        const currentFrameData = context.getImageData(0, 0, canvas.width, canvas.height).data;

        if(lastFrameData){
          let diff = 0;
          for(let i=0; i<currentFrameData.length; i+=4){
            diff += Math.abs(currentFrameData[i] - lastFrameData[i]);
          }
          const threshold = 1000000; // ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
          if(diff > threshold){
            puppet.style.display = 'block';
            status.textContent = "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß! üé≠";

            clearTimeout(motionTimeout);
            motionTimeout = setTimeout(() => {
              puppet.style.display = 'none';
              status.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß...";
            }, 3000);
          }
        }
        lastFrameData = currentFrameData;
        requestAnimationFrame(checkMotion);
      }
    })();
  </script>
</body>
</html>
